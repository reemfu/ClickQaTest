angular.module('GetCandidatesApp',[]),angular.module('GetCandidatesApp').controller('FormController',['$scope','$rootScope','$timeout','$http',function(a,b,c,d){b.state=1,b.slots=[],b.results=[],b.appointments=localStorage.getItem('appointments')?JSON.parse(localStorage.getItem('appointments')):[],a.durations={house:3,floor:2,car:1},a.availability={james:{start:8,end:20,weekend:!0},alfredo:{start:6,end:18,weekend:!1},ilya:{start:9,end:21,weekend:!0}},d.get('js/user.json').then(function(e){alert('Welcome '+e.user+'!')}).catch(function(e){console.error('UNABLE TO IDENTIFY USER'),console.error(e)}),a.customer='jams',a.worktype='house',a.$watch('name',function(e){window.document.getElementById('ResultName').innerHTML=e}),a.getCandidates=()=>{if(!(a.end instanceof Date))return void alert('End date not setted');if(a.start===a.end)return void alert('Start and End date can not be the same');b.state=2;let e=7,f=(a.end-a.start)/1e3/60/60/24;5>f&&(e=f+2),c(()=>{if(30<f)throw'CPU time limit exceeded: Aborting';b.state=3},1e3*e);for(let g=new Date(a.start);g<a.end;g.setDate(g.getDate()+1)){let h={date:new Date(g),slots:[]},j=a.availability[a.customer];if(j.weekend||5!==g.getDay()){for(let l,k=j.start;k<j.end;k++)l=!1,b.appointments.forEach(m=>{m.start==k&&(l=!0)}),l||h.slots.push({start:k,end:k+a.durations[a.worktype],grade:Math.floor(65+35*Math.random()),customer:a.customer,worktype:a.worktype,name:a.name});b.results.push(h)}}},b.$watch('state',function(e){1===e&&(a.start=void 0,a.end=void 0,a.name=void 0)})}]),angular.module('GetCandidatesApp').controller('LoadingController',['$scope','$rootScope','$timeout',function(){}]),angular.module('GetCandidatesApp').controller('OptionsController',['$scope','$rootScope','$timeout',function(a,b,c){a.selectSlot=(d,e)=>{c(()=>{d.date=e,b.appointments.push(d),b.lastSlot=d,b.state=4;let f=localStorage.getItem('appointments')?JSON.parse(localStorage.getItem('appointments')):[];f.push(b.lastSlot),localStorage.setItem('appointments',JSON.stringify(f)),a.saving=!1},1200),a.saving=!0}}]),angular.module('GetCandidatesApp').controller('ResultController',['$scope','$rootScope',function(a,b){a.anotherAppointment=()=>b.state=1,b.results=[]}]),angular.module('GetCandidatesApp').controller('AppointmentsController',['$scope','$rootScope',function(a,b){a.getAvgGrade=()=>{let c=0;return b.appointments.forEach(d=>c+=d.grade+7),c/=b.appointments.length,c=Math.floor(c),100<c?99:c}}]);